# -*- coding: utf-8 -*-
# lib/memo/explanation.py
#
# pages/05_メモ検索.py / pages/07_メモ作成・編集.py 用
# 利用者向け説明 expander
#
# ※ このモジュールは「説明表示のみ」を行う
# ※ DB更新・状態変更は行わない
# ※ use_container_width は使用しない

from __future__ import annotations

import streamlit as st


# ============================================================
# pages/05_メモ検索.py 用
# ============================================================
def render_memo_search_help_expander() -> None:
    """メモ検索・一覧・xlsx出力の使い方説明（05用）"""

    with st.expander("ℹ️ 使い方（検索 / 一覧 / xlsx 出力）", expanded=False):
        st.markdown(
            """
## 1. このページでできること
このページでは、**保存済みメモの検索・閲覧・出力**を行います。

- メモの検索（2種類の検索方式）
- 検索結果一覧の表示
- メモの表示・編集画面への移動
- 検索結果または全件の **xlsx 出力**

※ メモの新規作成は別ページ（作成・編集ページ）で行います。

---

## 2. 検索方式について（重要）
検索方式は **2種類**あります。用途に応じて使い分けてください。

### 2.1 普通（部分一致）【推奨】
- 対象：
  - 通常メモ：**タイトル / 本文 / タグ**
  - 暗号化メモ：**タイトル / タグ**（本文は対象外）
- 特徴：
  - 日本語の連続文字に強い
  - 直感的に使える
- 仕様：
  - 空白区切り → AND 条件
  - OR / and / () を含む論理表現に対応
  - 実際にヒットした語は **ハイライト表示**されます

#### 例
- `山田`
- `山田 太郎`
- `(山田 OR 鈴木) 太郎`

---

### 2.2 FTS（高速検索）
SQLite FTS5 を使った全文検索です。

- 特徴：
  - データ件数が多い場合に高速
  - 英数字・コード・固定語句向き
- 制約（重要）：
  - **日本語の空白区切り検索はできません**
  - `山田 太郎` → ❌ ヒットしません
  - `山田太郎` → ✅ ヒットする場合あり
  - `AND / OR` は **通常の論理式としては解釈されません**

#### 注意
FTS でヒットしない場合は、**普通検索に戻してください**。  
日本語メモの検索は、原則として普通検索を推奨します。

---

## 3. 暗号化メモの扱い（検索時）
- 暗号化メモの **本文は検索対象になりません**
- 検索対象は **タイトル / タグのみ**です
- 一覧プレビューでは `(暗号化メモ)` と表示されます

---

## 4. 一覧表示について
- 検索結果はページ分割表示されます
- 「表示」ボタンで詳細を開きます
- 検索条件を変えると、前回の表示状態は自動的に解除されます

---

## 5. xlsx 出力について
このページでは、次の2通りの出力ができます。

### 出力範囲
- **全部**：全メモを出力
- **現在の検索結果だけ**：検索条件に合致したメモのみ出力

### 出力内容
- 作成日時
- 更新日時
- カテゴリー
- タイトル
- タグ
- content_preview（本文の一部）
- （任意）本文全文

#### 注意
- 暗号化メモの本文は、原則として出力されません
- 「本文も含める」をONにするとファイルサイズが大きくなります
"""
        )
        st.caption("※ 検索・出力専用ページの説明です。")


# ============================================================
# pages/07_メモ作成・編集.py 用
# ============================================================
def render_memo_edit_help_expander() -> None:
    """メモ作成・編集・暗号化の使い方説明（07用）"""

    with st.expander("ℹ️ 使い方（メモ作成 / 編集 / 暗号化）", expanded=False):
        st.markdown(
            """
## 1. このページでできること
このページでは、**メモの作成・編集・削除**を行います。

- 新規メモの作成
- 既存メモの編集
- メモの削除
- 暗号化メモの作成・復号

---

## 2. 分類（カテゴリー）
メモには **2種類の分類**があります。

### 2.1 通常
- 本文は平文で保存されます
- 検索（普通 / FTS）の対象になります

### 2.2 暗号化（重要）
- 本文は **暗号化して保存**されます
- JSON 正本には **平文本文は保存されません**
- 復号キーを入力しない限り、本文は読めません

---

## 3. 復号キー（パスフレーズ）について（重要）
- 復号キーは **毎回入力**が必要です
- 復号キーは **ディスクやDBには保存されません**
- 復号キーを忘れると、**本文は復元できません**

### よくあるケース
- 本文が表示されない  
  → 復号キーが未入力、または間違っています
- 暗号化メモを保存できない  
  → 復号キーが入力されていません

---

## 4. セキュリティ上の注意
- 短く推測しやすい復号キーは安全ではありません
- 本アプリは **個人利用前提**です
- パスワード管理専用ツールとは目的が異なります

---

## 5. 削除について
- 削除は **取り消しできません**
- 削除確認チェックを入れないと実行できません
"""
        )
        st.caption("※ メモ作成・編集専用ページの説明です。")
