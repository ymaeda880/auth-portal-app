# 例：common_lib/auth/explanation.py
from __future__ import annotations
import streamlit as st


def render_portal_usage_expander() -> None:
    """
    認証ポータル（auth_portal_app）の使い方・権限体系・
    ユーザー名/パスワード規則を説明する expander を描画する。
    """
    with st.expander("ℹ️ 認証ポータルの使い方とアクセス権（クリックで開く）", expanded=False):
        st.markdown(
            """
            ### 1. このポータルの役割

            - この画面は，各種アプリケーションへアクセスするための**共通ポータル**です．  
            - ログイン状態とユーザー権限に応じて，アクセスできるアプリの一覧が変わります．  
            - ログイン情報は JWT（署名付きトークン）としてブラウザに保存されます．  

            ---

            ### 2. アプリの区分（アクセスレベル）

            1. **🌐 ログイン不要アプリ（PUBLIC）**  
            2. **🔏 制限付きアプリ（RESTRICTED）**  
            3. **🔐 ログインが必要なアプリ（USER）**  
            4. **🛡 管理者アプリ（ADMIN）**  

            - いずれのアプリがどの区分に属するかは，  
              **settings.toml（access セクション）だけが真実のソース**です．

            ---

            ### 3. ログイン・ログアウト

            - ユーザー名とパスワードでログインできます．  
            - ログイン成功後は，指定されたアプリ一覧が表示されます．  
            - 作業後はサイドバーの「ログアウト」からクッキーを削除できます．  

            ---

            ### 4. 別ユーザーでサインイン

            - ログイン中でも「別のユーザーでサインイン」ボタンを押すと  
              ログインフォームを再表示できます．  

            ---

            ### 5. ユーザー登録（サインアップ）

            - 「🆕 ユーザー登録」欄から，新たにユーザー名とパスワードを作成できます．  
            - ただし，**アクセス権限（どのアプリを使えるか）は settings.toml で管理**するため，  
              登録しただけでは利用できるアプリが無い場合があります．  

            ---

            ### 6. パスワード変更

            - ログイン中のユーザーは「🔑 パスワード変更」から  
              現在のパスワード → 新パスワードへ変更できます．  
            - パスワードはハッシュ化されて保存されます．  

            ---

            ### 7. next パラメータによる自動遷移

            - URL に `next=/some/path` が含まれている場合，  
              ログイン成功後にそのパスへ自動的に移動します．  

            ---

            ### 8. ユーザー名・パスワードの規則

            #### ユーザー名の規則
            推奨ルールは次のとおりです：

            - 半角英数字（`a-z`, `A-Z`, `0-9`）と `-` `_` `.` のみ  
            - 最初の文字は英字を推奨  
            - 空白は使えません  
            - 大文字・小文字は区別されます  
            - 長さは **3〜32文字** を推奨  

            運用上，ユーザー名は「ログインID」としてファイル (`users.json`) に保存されるため，  
            **できるだけ簡潔・一意で，URL やファイル名に問題が出ない形式**を推奨します。

            例：  
            - `taro`  
            - `hanako.sato`  
            - `ito_ken`  

            #### パスワードの規則
            こちらは一般的な強度基準に従うことを推奨します：

            - **8文字以上**（12文字以上を推奨）  
            - 以下のうち **3種類以上** を含むこと  
              - 大文字（A–Z）  
              - 小文字（a–z）  
              - 数字（0–9）  
              - 記号（例：`!@#$%^&*`）  
            - 空白は不可  
            - ユーザー名をそのまま含めない  
            - 辞書攻撃に弱い単語（`password`, `abcd1234` 等）は避ける  

            システム側ではハッシュ化して保存されるため，  
            運用上は **忘れない・他人が推測できない** パスワードを設定してください。

            ---

            ### 9. セキュリティ上の注意

            - 共有端末ではログアウトを必ず実行してください．  
            - 不審なログインやアクセス権の不具合を見つけた場合は管理者に連絡してください．  
            """
        )
