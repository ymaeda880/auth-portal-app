# -*- coding: utf-8 -*-
# lib/ai_memo/explanation.py
#
# pages/07_AIメモ.py の利用者向け説明（Streamlit用）
# - UI上に「使い方」expander を追加するための部品
# - 特に「AI検索（ベクトル検索）」の考え方と運用ルール（機密を入れない）を明記
#
# ※このファイルは “説明を表示するだけ” のモジュールです（DB更新等はしません）
# ※ use_container_width は使いません

from __future__ import annotations

import streamlit as st


def render_ai_memo_help_expander() -> None:
    """AIメモページの使い方を説明する expander を描画する。"""

    with st.expander("ℹ️ 使い方（AIメモ / AI検索の説明）", expanded=False):
        st.markdown(
            """## 1. このページでできること
- **AIメモを作成**：分類（カテゴリ）を選び、タイトル・タグ・本文を保存します。
- **AI検索（ベクトル検索）**：自然文で検索し、近い内容のメモ候補を表示します。
- **表示 / 編集 / 削除**：選択したメモを開いて、更新または削除します。

---

## 2. 重要な運用ルール（必ず守る）
AIメモは「AI検索に使う」ことを前提にしているため、以下の運用規則を守ってください。

- **個人情報（住所・電話・生年月日など）を入れない**
- **パスワード・秘密鍵・APIキーを入れない**
- **機密情報（契約・顧客情報・社内秘）を入れない**

### パスワード管理の考え方（推奨）
- AIメモには「パスワードそのもの」は書きません。
- 書くなら「自分だけが分かるヒント」までにしてください。
  - 例：『Gmail: 2段階認証の復旧コードを保管した場所』のような“場所”や“手順”
  - NG：実パスワード / 復旧コード / 秘密の答え そのもの

---

## 3. 分類（カテゴリ）とタグ
- **分類（カテゴリ）**：用途の大枠（例：調査 / アイデア / 議事メモ / TODO / その他）
- **タグ**：キーワード（例：RAG, governance, meeting, cost など）

カテゴリは「一覧で探しやすくする」ため、タグは「後から検索しやすくする」ために使います。

---

## 4. AI検索（ベクトル検索）とは？
このページのAI検索は、SQLiteの全文検索（FTS）ではなく、**ベクトル検索**です。

- 入力した文章（検索クエリ）を **埋め込み（embedding）** に変換し、
- 保存済みメモのベクトルと **意味的な近さ** を計算して、候補を返します。

### 特徴
- 単語が一致していなくても「意味が近い」ものが見つかります。
- **自然文で質問してOK**（例：「前回の会議で決めた論点は？」）
- 一方で、**完全一致・部分一致の保証**はありません（意味近傍なので）。

---

## 5. 使い方（検索の例）
### 5.1 自然文の質問
- `前回の会議で決めた論点は？`
- `RAGの更新手順をもう一度確認したい`

### 5.2 キーワード列
- `AI 業務効率化 事例`
- `embedding コスト 見積`

### 5.3 検索のコツ
- まずは短めに（1文〜2文）
- うまく出ないときは **言い換える**
  - 例：「業務効率化」→「自動化」「省力化」「プロセス改善」

---

## 6. パラメータ（候補数 / スコア下限）
- **候補数（top_k）**：多くすると拾いやすいが表示が増えます（まずは10前後）。
- **スコア下限（min_score）**：0.0〜弱め推奨。強くしすぎると“該当なし”になりやすいです。

---

## 7. 検索結果の見方
検索結果は「更新日時 / 分類 / タイトル / 本文冒頭（プレビュー）/ スコア」などで表示されます。

- **スコアが高いほど近い**（ただし絶対値はデータ・モデルで変動）
- 近い候補が複数出たら、まずは上位から開いて確認してください

---

## 8. よくある質問
### Q. 「単語一致」で探したい
A. AI検索は意味検索なので、単語一致だけで探す用途には向きません。
- 厳密一致が必要なら、個人メモ（AI不使用）の「普通（部分一致）」を使う方が確実です。

### Q. 検索精度を上げたい
A. まずは「メモ本文」を少し丁寧に書く（背景/結論/要点）と改善します。
- 将来的には **rerank（再ランキング）** や **要約/回答生成** を追加する予定です。

"""
        )
        st.caption("※AI検索は“意味検索”です。個人情報・機密情報を入れない運用を徹底してください。")
